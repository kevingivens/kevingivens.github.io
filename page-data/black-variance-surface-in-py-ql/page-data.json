{"componentChunkName":"component---src-templates-post-tsx","path":"/black-variance-surface-in-py-ql","result":{"data":{"post":{"slug":"/black-variance-surface-in-py-ql","title":"Black Variance Surface in PyQL","date":"04.01.2020","tags":[{"name":"QuantLib","slug":"quant-lib"}],"description":null,"canonicalUrl":null,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Black Variance Surface in PyQL\",\n  \"date\": \"2020-01-04T00:00:00.000Z\",\n  \"tags\": [\"QuantLib\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Summary: Building Black Variance Surfaces in PyQL\"), mdx(\"p\", null, \"In my previous \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"lostinthelyceum.com/Variance-Swaps-in-PyQL.html\"\n  }, \"post\"), \" on Variance\\nSwaps, I neglected to mention an important implementation detail.  If you look\\nthe Variance Swap unittest or example script you'll see that replicating pricer\\nrequires a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BlackVarianceSurface\"), \" object.  I had to build bindings for these\\nin PyQL so I thought I'd mention how they work.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BlackVarianceSurface\"), \" is a volatility termstructure that implements different\\ntypes of 2-d interpolation routines between implied volatility quotes. I included\\ntwo types of interpolations from the Quantlib source code:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Bilinear\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Bicubic\")), mdx(\"p\", null, \"To over simplify, Bilinear linearly interpolates between neighboring quotes.\\nBicubic uses a cubic spline routine (third order polynomial) to smoothly\\ninterpolate between points.\"), mdx(\"p\", null, \"See for \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://en.wikipedia.org/wiki/Bicubic_interpolation\"\n  }, \"wikipedia\"), \" for a\\nnice summary of the differences between bicubic vs. bilinear interpolation.\"), mdx(\"p\", null, \"The python interface is given in the example below\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"...\\ndc = Actual365Fixed()\\ncalendar = UnitedStates()\\n\\ncalculation_date = Date(6, 11, 2015)\\n\\nspot = 659.37\\nSettings.instance().evaluation_date = calculation_date\\n\\ndividend_yield = SimpleQuote(0.0)\\nrisk_free_rate = 0.01\\ndividend_rate = 0.0\\n# bootstrap the yield/dividend/vol curves\\nflat_term_structure = FlatForward(\\n    reference_date=calculation_date,\\n    forward=risk_free_rate,\\n    daycounter=dc\\n)\\n\\nflat_dividend_ts = FlatForward(\\n    reference_date=calculation_date,\\n    forward=dividend_yield,\\n    daycounter=dc\\n)\\n\\ndates = [\\n    Date(6,12,2015),\\n    Date(6,1,2016),\\n    Date(6,2,2016),\\n    Date(6,3,2016),\\n]\\n\\nstrikes = [527.50, 560.46, 593.43, 626.40]\\n\\ndata = np.array(\\n    [\\n        [0.37819, 0.34177, 0.30394, 0.27832],\\n        [0.3445, 0.31769, 0.2933, 0.27614],\\n        [0.37419, 0.35372, 0.33729, 0.32492],\\n        [0.34912, 0.34167, 0.3355, 0.32967],\\n        [0.34891, 0.34154, 0.33539, 0.3297]\\n    ]\\n)\\n\\nvols = Matrix.from_ndarray(data)\\n\\n# Build the Black Variance Surface\\nblack_var_surf = BlackVarianceSurface(\\n    calculation_date, NullCalendar(), dates, strikes, vols, dc\\n)\\n\\nstrike = 600.0\\nexpiry = 0.2 # years\\n\\n# The Surface interpolation routine can be set below (Bilinear is default)\\nblack_var_surf.set_interpolation(Bilinear)\\nprint(\\\"black vol bilinear: \\\", black_var_surf.blackVol(expiry, strike))\\nblack_var_surf.set_interpolation(Bicubic)\\nprint(\\\"black vol bicubic: \\\", black_var_surf.blackVol(expiry, strike))\\n\")), mdx(\"p\", null, \"As a sanity checked, I re-implemented results from an excellent blog\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://gouthamanbalaraman.com/blog/volatility-smile-heston-model-calibration-quantlib-python.html\"\n  }, \"post\"), \"\\nby Gouthaman Balaraman.  In that post, the author builds a BlackVarianceSurface\\nobject using Quantlib's swig bindings.\"), mdx(\"p\", null, \"The plots for the same market data are given below:  \"), mdx(\"p\", null, \"For Bilinear interpolation, the surface looks like\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"63.74999999999999%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAB3UlEQVQ4y32T3W7TQBCF86hIvAISUsUb9BLEDVdIwAWgggBxg0gFagQFlSQoSUlUEFHdpLFjr9c/Gzv2+kO7DcL5KSOtd7wzPj5ndqbBhlVVxf/MxDdX3RqbSX/fy7L8t7SmKIq1eFX7bnVo/Uadld1NQGsiKZnPPWazGUEQEPi+Ba1R3amqsXlonnmek2Q5cZoiZIQIJTKKCMOQKIpQqcJw1EXJUmVrpVhjqKsKOZladvLngPj9U2TnA8KbIQLfMjU/mE4mGK5Rt83p3i2KmsJGXaoG3NZHxMN91Mv7qLcPiI8OkO0m8ck75I+vBJcOc88lzpYU5yPE87tkRbkDEGzxYyPr8Bnx8Wvc3me8wTFBr4Xb/4IzaDN3xsxclzRVqCTm93BAlmXXAJYliVL4QtL5Pqb/y+NkGPDt9JL2yGM88QllaAGhxPErDj4plvliN6A2t2uLHtHqL9h/HPDkUPHoCJrdjDiSV3UU0uZ3h4o79xwqvdwNaHYpJb7vk0SCV02Xm7d73Ng7o9URJLHPuXPBYnHFKFVLLqbJ9i2vsyxtvwkhyDOJ48x58eaM4WhC4HtWwWbvbfXhWmOvzMjXulp1ppmUnLLU9SG0+bqqVj67GW7Op3G13p7l6+b+D/li5/HWRNpCAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"bilinear\",\n    \"title\": \"bilinear\",\n    \"src\": \"/static/e2bcc0bae84a0ea21629d1ef9169bf7e/7d769/BlackVol_Bilinear.png\",\n    \"srcSet\": [\"/static/e2bcc0bae84a0ea21629d1ef9169bf7e/5243c/BlackVol_Bilinear.png 240w\", \"/static/e2bcc0bae84a0ea21629d1ef9169bf7e/ab158/BlackVol_Bilinear.png 480w\", \"/static/e2bcc0bae84a0ea21629d1ef9169bf7e/7d769/BlackVol_Bilinear.png 960w\", \"/static/e2bcc0bae84a0ea21629d1ef9169bf7e/16c83/BlackVol_Bilinear.png 1311w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, \"For Bicubic interpolation, the surface looks like\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"72.91666666666666%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA9hAAAPYQGoP6dpAAACFUlEQVQ4y4WTTWsTURSG8x/9B27cuLS41IW4EAsFBRUUrEJdWHDRQqEVYov1s2LVNtTERlOb2Mzk5n7MvTOT+XokCQWTTOvZzB3OOc99z+W8FaaiKArOi//lK/8Wnhafnsv+y3IzwOmiNEkwWiP7fUSvh9YapRTOOaYFFFk2Aa+UjVMUOWGaoq1DKI1UenSBc5YkScjz/MynqEyPmw4G2ChGHtYRz+4ht1aRfYEMLEKbEVwIQTwYkLmQk603REpPKhzBhlDA39vn163r+PNzyIUr2Kc3sZvLBB820Hvv0X1Bz/eJ0oyofUTt4gV0szEG5vkkcDiIPjnBm79KsHiDcOU+buMJbn0Rt/YQt7FI8GUT4fv4QpKqHubFHZzXLlEI5FmKjROC75+w1SXk51eonXWCj2uo3Sri62tUp4Xv9zDGMIhCfu7vYpQ8A5jnWGtR2lCvHdKqH3Dw45j6QZNmo0Gn3R7lut0ueZZgwozVnRCv784GBoEltJqdRsRS1bH9TfJyL2W7ZlFqvD6e5wMZbT/h8m2P5rEd908Dh19tDFL26QnFg5WQubuShWXD21qEs4qu543Aw+irAY+ft+j6dlbhKTQMw1GDMZKj3z6Pljtcutak+s5HSY9W64g4js/fwzK3GBMQR444MnQ9SeePhxA9oiiaqM/yYtYpZYYfN4y2iTzPSNNkxr9lvi5VONNQas+iVMhfljx8a1LYnkcAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"bicubic\",\n    \"title\": \"bicubic\",\n    \"src\": \"/static/ff219ee6f881909268ca342c4904b35d/7d769/BlackVol_Bicubic.png\",\n    \"srcSet\": [\"/static/ff219ee6f881909268ca342c4904b35d/5243c/BlackVol_Bicubic.png 240w\", \"/static/ff219ee6f881909268ca342c4904b35d/ab158/BlackVol_Bicubic.png 480w\", \"/static/ff219ee6f881909268ca342c4904b35d/7d769/BlackVol_Bicubic.png 960w\", \"/static/ff219ee6f881909268ca342c4904b35d/55ab0/BlackVol_Bicubic.png 1159w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, \"As you can see from the plots, the bicubic is slightly smoother than bilinear.\"), mdx(\"p\", null, \"Take a look at the PyQL bindings on my \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/kevingivens/pyql\"\n  }, \"github\"), \" page to see how the\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BlackVarianceSurface\"), \" is implemented.  The script to generate the plots is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/kevingivens/Blog/tree/master/2020/BlackVol\"\n  }, \"here\"), \"  \"), mdx(\"p\", null, \"One thing that I clearly need to improve is the flexibility on the volatility data\\nstructure input to the BlackVarianceSurface constructor. It would be better to\\nallow the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vols\"), \" data structure to be either a list of lists, a numpy array,\\nor a QL Matrix object.  I'll try to fix that at some point.\"), mdx(\"p\", null, \"See you next time.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Summary: Building Black Variance Surfaces in PyQL In my previous  post  on Variance\nSwaps, I neglected to mention an important…","timeToRead":1,"banner":null}},"pageContext":{"slug":"/black-variance-surface-in-py-ql","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["2744905544","3090400250","318001574"]}